<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2 id="team_info">Team Info</h2><br>
<h2 id="my_tasks_in_team">내 업무</h2><br>

<script>
    // URL에서 teamId를 추출하는 함수
    function getTeamIdFromURL() {
        const url = window.location.href;
        const match = url.match(/\/views\/team\/(\d+)/); // 정규식을 사용하여 추출
        if (match) {
            return match[1];
        } else {
            throw new Error("Team ID not found in URL");
        }
    }

    const teamId = getTeamIdFromURL();

    // /api/team/{teamId} 팀 정보 조회
    let Jwt = localStorage.getItem("JWT");
    fetch('/api/team/' + teamId, {
        headers: {
            "Authorization": "Bearer " + Jwt
        },
        method: "GET"
    })
        .then(response => response.json())
        .then(data => {
            // Team Info
            const team_info = document.getElementById('team_info');
            const team_name = document.createElement('h2');
            team_name.textContent = data.name;
            team_info.appendChild(team_name);
            const team_desc = document.createElement('p');
            team_desc.textContent = data.desc;
            team_info.appendChild(team_desc);
            const team_limit = document.createElement('p');
            team_limit.textContent = data.memberLimit;
            team_info.appendChild(team_limit);
        })

    // /api/team/{teamId}/tasks 팀 업무 전체 조회
    fetch('/api/team/' + teamId + '/tasks', {
        headers: {
            "Authorization": "Bearer " + Jwt
        },
        method: "GET"
    })
        .then(response => response.json())
        .then(data => {
            // All tasks
            const allTasksSection = document.createElement('h2');
            allTasksSection.textContent = "완료된 업무";

            const todoTasksSection = document.createElement('h2');
            todoTasksSection.textContent = "미완료 업무";

            data.forEach(task => {
                const taskElement = document.createElement('p');
                taskElement.textContent = task.taskName + "   " + task.status;

                allTasksSection.appendChild(taskElement); // "모든 업무" 섹션에 추가
                if (task.status !== 'DONE') {
                    todoTasksSection.appendChild(taskElement); // "미완료 업무" 섹션에 추가
                }
            });

            document.body.appendChild(todoTasksSection);
            document.body.appendChild(allTasksSection);
        });


    // /api/team/{teamId}/tasks/myTasks 팀 내 내 업무 조회
    fetch('/api/team/' + teamId + '/tasks/myTasks',
        {
            headers: {
                "Authorization": "Bearer " + Jwt
            },
            method: "GET"
        })
        .then(response => response.json())
        .then(data => {
            const myTasks = document.getElementById('my_tasks_in_team');
            const myTasks_all = document.createElement('div');
            data.forEach(task => {
                const taskElement = document.createElement('p');
                taskElement.textContent = task.taskName;
                myTasks_all.appendChild(taskElement);
            });
            myTasks.appendChild(myTasks_all);
        })
</script>
</body>
</html>