<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>업무 생성 페이지</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <style>
    .form-control {
      width: 70vw;
    }
  </style>
</head>
<body>
<h1 class="text-center mb-5">
  <button id="to_main_button" type="button" class="btn btn-info">메인</button>
  업무 등록하기
  <button id="logout_button" type="button" class="btn btn-info">로그아웃</button>
</h1>
<div class="mb-3">
  <label>업무명</label>
  <input type="text" class="form-control" id="task_name" placeholder="업무명을 입력해주세요.">
</div>
<div class="mb-3">
  <label>업무 소개</label>
  <input type="text" class="form-control" id="task_desc" placeholder="업무에 대한 간단한 소개를 적어주세요.">
</div>
<div class="mb-3">
  <label>업무 시작일</label>
  <input type="date" class="form-control" id="task_start"
         placeholder="업무 시작일을 입력해주세요.">
</div>
<div class="mb-3">
  <label>업무 종료일</label>
  <input type="date" class="form-control" id="task_end"
         placeholder="업무 종료일을 입력해주세요.">
</div>
<div class="mb-3">
  <label>업무 담당자</label>
  <input type="text" class="form-control" id="task_worker" placeholder="업무 담당자를 입력해주세요.">
</div>

<div class="d-grid">
  <button class="btn btn-primary btn-lg" id="sign-in-button" type="button" onclick="create_task()">생성하기</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
<script>
  const Jwt = localStorage.getItem("JWT");
  let auth = "Bearer " + Jwt;
  const teamId = getTeamIdFromURL();
  console.log(teamId);

  function getTeamIdFromURL() {
    const url = window.location.href;
    const match = url.match(/\/views\/team\/(\d+)\/tasks/);
    if (match) {
      return match[1];
    } else {
      throw new Error("Team ID not found in URL");
    }
  }
  function create_task() {
    const name = document.getElementById("task_name").value;
    const desc = document.getElementById("task_desc").value;
    const start = document.getElementById("task_start").value;
    const end = document.getElementById("task_end").value;
    const worker = document.getElementById("task_worker").value;


    fetch('/api/team/' + teamId + '/tasks', {
      headers: {
        "Authorization": auth,
        'Content-Type': 'application/json'
      },
      method: "POST",
      body: JSON.stringify({
        "taskName": name,
        "taskDesc": desc,
        "startDate": start,
        "dueDate": end,
        "worker" : worker
      })
    })
            .then(response => {
              if (response.ok) {
                alert("성공적으로 업무가 생성되었습니다.")
                window.location.href = "/views/team/" + teamId;
              }
            })
            .catch(error => {
              alert(error.message);
            })
  }
</script>
<!--로그아웃 스크립트-->
<script>
  const logout_button = document.getElementById("logout_button");
  logout_button.addEventListener("click", () => {
    localStorage.removeItem("JWT")
    window.location.href = "/views/main";
  })
</script>
<!--메인으로 가기 스크립트-->
<script>
  const main_button = document.getElementById("to_main_button");
  main_button.addEventListener('click', () => {
    window.location.href = "/views/main";
  })
</script>

</body>
</html>