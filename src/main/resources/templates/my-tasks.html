<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>나의 작업</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="button.css">
    <style>
        /* 전체 페이지 스타일링 */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0; /* 페이지 배경색 설정 */
            margin: 0;
            padding: 0;
        }

        /* 페이지 제목 스타일링 */
        h1 {
            background-color: #007acc; /* 배경색 설정 */
            color: #fff; /* 텍스트 색상 설정 */
            text-align: center; /* 가운데 정렬 */
            padding: 20px 0; /* 위아래 패딩 설정 */
            margin: 0;
        }

        /* 목록 스타일링 */
        #myTasksList {
            list-style: none; /* 목록 마커 제거 */
            padding: 0;
            margin: 20px; /* 전체 여백 설정 */
        }

        /* 링크 스타일링 */
        a {
            text-decoration: none; /* 밑줄 제거 */
            color: #007acc; /* 링크 색상 설정 */
        }

        /* 링크 호버 효과 */
        a:hover {
            text-decoration: underline; /* 호버 시 밑줄 추가 */
        }

        ul {
            margin: 0;
            padding: 0;
        }

        li {
            margin: 10px 0; /* 목록 항목 간 여백 설정 */
        }
    </style>

</head>
<body>
<h1>
    <button id="to_main_button" type="button" class="btn btn-info">메인</button>
    나의 작업
    <button id="logout_button" type="button" class="btn btn-info">로그아웃</button>
</h1>
<ul id="myTasksList"></ul>
<script>
    let Jwt = localStorage.getItem("JWT");
</script>
<!--내 업무 조회-->
<script>
    fetch('/api/users/myTasks', {
        headers: {
            "Authorization": "Bearer " + Jwt
        },
        method: "GET"
    })
        .then(response => response.json())
        .then(map_object => {
            const myTasksList = document.getElementById('myTasksList');
            myTasksList.innerHTML = ''; // 목록 초기화

            for (const element in map_object) {
                let startIndex = element.indexOf("teamName=") + 9;
                let endIndex = element.indexOf(",", startIndex);
                const team_name = element.substring(startIndex, endIndex);

                startIndex = element.indexOf("id=") + 3;
                endIndex = element.indexOf(",", startIndex);
                const team_id = element.substring(startIndex, endIndex);

                const teamHeader = document.createElement('a');
                teamHeader.textContent = '팀이름 : ' + team_name;
                teamHeader.setAttribute('href', '/views/team/' + team_id);
                myTasksList.appendChild(teamHeader);
                const taskList = document.createElement('ul');

                const tasks = map_object[element];
                tasks.forEach(task => {
                    const taskItem = document.createElement('a');
                    const task_id = task.id;
                    console.log(task_id);
                    taskItem.textContent = task.taskName;
                    taskItem.setAttribute('href', '/views/team/' + team_id + '/tasks/' + task_id);
                    taskList.appendChild(document.createElement('br'));
                    taskList.appendChild(taskItem);
                });
                myTasksList.appendChild(taskList);
                myTasksList.appendChild(document.createElement('hr'));

            }
        })
        .catch(error => {
            alert(error.method);
            window.location.href="/views/login";
        });
</script>
<!--로그아웃 스크립트-->
<script>
    const logout_button = document.getElementById("logout_button");
    logout_button.addEventListener("click", () => {
        localStorage.removeItem("JWT")
        window.location.href = "/views/main";
    })
</script>
<!--메인으로 버튼 스크립트-->
<script src="/js/main-button.js"></script>
<!--부트스트랩 스크립트-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>
